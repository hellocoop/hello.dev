import { Steps } from 'nextra/components'
import { Tabs } from 'nextra/components'
import { Callout } from 'nextra/components'


# Next.js Quickstart

Follow the directions below to add Hellō to your application in a couple minutes. 

Users will have access to all the Hellō login options including Apple, Facebook, Google, GitHub, GitLab, and Microsoft.

<Callout type="info" emoji="ℹ️">
    If you want to explore a sample app, check out our [Hellō Next.js Sample](https://github.com/hellocoop/hello-nextjs-sample).
</Callout>

## Add Hellō to Your Server

In your project directory:

<Steps>
### Install the package 

```sh npm2yarn
npm i @hellocoop/nextjs
```

### Run Quickstart

```sh
npx @hellocoop/quickstart@latest --nextjs
 ```
Quickstart will prompt you to:
- download the `@hellocoop/quickstart` package
- log in to Quickstart with Hellō
- create an application, or select an existing one

Quickstart will then:
- create a `hello.config.ts` file containing your app's `client_id`
- mount the Hellō endpoint by creating the `./pages/api/hellocoop.ts` file
- generate a random `HELLO_COOKIE_SECRET` and add it to `env.local`

Your server should now be fully configured to work with Hellõ

### Test Your Server

Start your application locally:

```sh
npm run dev
```

Assuming the server starts on port 3000, 

1. Load this link to check your logged in status:

http://localhost:3000/api/hellocoop?auth=true

You should get `{"isLoggedIn"=false}`

2. Log in to Hellō with:

http://localhost:3000/api/hellocoop?login=true

and see your logged in status and profile with:

http://localhost:3000/api/hellocoop?auth=true

3. Log out with:

http://localhost:3000/api/hellocoop?logout=true

and confirm you are logged out with:

http://localhost:3000/api/hellocoop?auth=true


</Steps>

You have configured your server to use Hellō!

## Add Hellō to Your Client

<Steps>

### Add Hellō stylesheet

To provide the styling for Hellō buttons, add the below code to the `<Head>` section of your `_document.tsx` or `_document.jsx` file:


```html filename="_document.tsx or _document.jsx"
<link rel="stylesheet" href="https://cdn.hello.coop/css/hello-btn.css"/>
```

### Add Image Hosts

To use the [`Image Component`](https://nextjs.org/docs/pages/api-reference/components/image) to display profile pictures add the Hellō and Gravatar `domains` to the `images` section of your `next.config.js` file: 

```js {4-6} filename="next.config.js"
const nextConfig = {
    images: {
      domains: [
        'cdn.hello.coop',
        'pictures.hello.coop',
        'www.gravatar.com'
      ]
    }
}
```

### Add Hellō Test Page

Copy the following code and save it to `hello-test.tsx` or `hello-test.jsx` in your `pages` folder:

<Tabs items={['TypeScript', 'JavaScript']}>
  <Tabs.Tab>
```typescript filename="./pages/hello-test.tsx"
import { LoggedOut, LoggedIn, Continue, useAuth } from `@hellocoop/nextjs/react`

export default test () => {
    return (
        <>
            <LoggedOut>
                <>
            </LoggedOut>
            <LoggedIn>



)}
```
  </Tabs.Tab>
  <Tabs.Tab>
```javascript filename="./pages/hello-test.jsx"
const { LoggedOut, LoggedIn, Continue, useAuth } = require()`@hellocoop/nextjs/react`)

export default test () => {
    return (
        <>
            <LoggedOut>
                <>
            </LoggedOut>
            <LoggedIn>



)}
```
  </Tabs.Tab>
</Tabs>


### Test Your Client

1. Load the test page:

http://localhost:3000/hello-test

2. Clink on the `[ ō  Continue with Hellō ]` button

This will log you in and display your profile information.

3. Click on the `log out` link to log out

</Steps>

You now have added Hellō to your Client!

## Add a Callback Stub

We will add and configure a stub that you will modify later to integrate with your user database.

<Steps>

### Create callback file

Copy the following code and save it to `hello-callback.ts` or `hello-callback.js` in your `src` folder:

<Tabs items={['TypeScript', 'JavaScript']}>
  <Tabs.Tab>
```typescript filename="./src/hello-callback.ts"
// hello-callback.ts
import type { LoggedInParams, LoggedInResponse } from '@hellocoop/nextjs'
 
export default async loggedInCallback ({ 
    payload,    // parsed ID Token payload
    token,      // ID Token in compact, unparsed format
    req,        // NextApiRequest
    res         // NextApiResponse
}:LoggedInParams): Promise<LoggedInResponse> => {

    console.log('Callback received:',JSON.stringify(payload))
    // TODO
    // lookup user from your DB wth payload.sub user identifier
    // create a user in DB if not found if open registration

    return({
        // accessDenied = true, // will set auth.isLoggedIn = false
        // isProcessed = true,  // response has been sent by callback()
        // updatedAuth = {},    // auth object stored in cookie
    })
}
```
  </Tabs.Tab>

  <Tabs.Tab>
```javascript filename="./src/hello-callback.js"
// hello-callback.js
module.export = async () => { 
    payload,    // parsed ID Token payload
    token,      // ID Token in compact, unparsed format
    req,        // NextApiRequest
    res         // NextApiResponse
} => {

    console.log('Callback received:',JSON.stringify(payload))
    // TODO
    // lookup user from your DB wth payload.sub user identifier
    // create a user in DB if not found if open registration

    return({
        // accessDenied = true, // will set auth.isLoggedIn = false
        // isProcessed = true,  // response has been sent by callback()
        // updatedAuth = {},    // auth object stored in cookie
    })
}
```
  </Tabs.Tab>
</Tabs>

### Configure Callback

Add the highlighted lines to your `hello.config.ts` file:

```ts {2,6-8}
import type { Config } from '@hellocoop/nextjs'
import loggedIn from './src/hello-callback'

const config = {
    client_id: '${client_id}',
    callbacks: {
        loggedIn
    }
}
export default config
```

### Test The Callback

1. Start your server as usual:
```sh
npm run dev
```
2. Load the test page and clink on the `[ ō  Continue with Hellō ]` button

http://localhost:3000/hello-test

You should see the contents of the ID Token payload logged to your terminal.

</Steps>

You now have a stub you can extend to integrate your user database.

## Next Steps

Update your [`hello.config.js`](/docs/sdks/nextjs/#helloconfigts) to change the claims received or providers recommended to new users.

Explore the [Hellō Next.js Sample](https://github.com/hellocoop/hello-nextjs-sample)

Review the [SDK Reference | Next.js](../sdks/nextjs) documentation.
